# FlyKylin 聊天功能测试指南

## 测试环境
- **时间**: 2025-11-20 00:27
- **版本**: Sprint 2 - US-004 文本消息
- **平台**: Windows x64

## 🧪 测试步骤

### 1. 启动验证
- [x] 程序成功启动（进程ID: 37504）
- [ ] 主窗口显示正常
- [ ] 标题显示 "FlyKylin P2P Chat - Sprint 1 Demo"
- [ ] 用户列表显示正常

### 2. P2P节点发现测试
- [ ] 检查状态栏显示 "✓ 服务启动成功 | UDP端口: 45678 | TCP端口: 45679"
- [ ] 因为启用了loopback模式，应该能发现本机节点
- [ ] 用户列表中应显示本机用户（如果有多个实例运行）

### 3. 聊天窗口测试

#### 步骤 A: 打开聊天窗口
1. **单击**用户列表中的用户（选中）
2. **双击**用户列表中的用户
3. ✅ 应该弹出ChatWindow聊天窗口

#### 步骤 B: 界面检查
- [ ] 窗口标题显示 "Chat Window"
- [ ] 顶部显示 "Chat with [用户名]"
- [ ] 消息显示区域（空白或有历史消息）
- [ ] 底部输入框显示 "Type a message..."
- [ ] 蓝色"Send"按钮

#### 步骤 C: 发送消息
1. 在输入框输入测试消息：`Hello, this is a test message!`
2. 点击"Send"按钮
3. ✅ 输入框应清空
4. ✅ 消息应显示在聊天区域（蓝色气泡，右对齐）
5. ✅ 显示发送时间

#### 步骤 D: 消息样式验证
- [ ] 发送的消息：蓝色气泡（#0078d4）、右对齐、白色文字
- [ ] 接收的消息（如果有）：灰色气泡（#e5e5e5）、左对齐、黑色文字
- [ ] 消息气泡有圆角（border-radius: 10px）
- [ ] 时间戳显示在消息下方（小字、灰色）

### 4. 多窗口管理测试

#### 测试场景1: 打开多个聊天窗口
1. 如果有多个用户，分别双击不同用户
2. ✅ 应该打开多个独立的ChatWindow
3. ✅ 每个窗口对应不同用户
4. ✅ 窗口之间互不干扰

#### 测试场景2: 窗口复用
1. 双击用户A，打开聊天窗口
2. 再次双击用户A
3. ✅ 不应创建新窗口
4. ✅ 现有窗口应前置显示

#### 测试场景3: 窗口关闭
1. 关闭某个聊天窗口
2. ✅ 窗口应正常关闭
3. ✅ 不影响其他窗口
4. 再次双击同一用户
5. ✅ 应创建新窗口

### 5. 消息功能测试

#### 测试场景1: 连续发送
1. 输入消息 "Message 1"，点击Send
2. 输入消息 "Message 2"，点击Send
3. 输入消息 "Message 3"，点击Send
4. ✅ 所有消息按顺序显示
5. ✅ 自动滚动到最新消息

#### 测试场景2: 空消息处理
1. 不输入任何内容，点击Send
2. ✅ 应无反应（不发送空消息）
3. 输入空格，点击Send
4. ✅ 应无反应（trim后为空）

#### 测试场景3: 长消息
1. 输入很长的消息（200字符以上）
2. 点击Send
3. ✅ 消息应正常显示
4. ✅ 消息气泡自动换行（word-wrap）
5. ✅ 最大宽度限制（350px）

### 6. 已知限制

⚠️ **当前版本限制**:
1. **TCP连接未完全实现** - 消息可能无法真正发送到远程节点
2. **消息只存储在内存** - 重启程序后消息历史丢失
3. **无消息状态指示** - 无法显示"发送中"、"已送达"、"失败"状态
4. **本地用户ID为占位符** - 使用"local_user"而非真实UUID
5. **无头像显示** - 消息气泡旁没有用户头像

## 📋 测试检查清单

### 基础功能
- [ ] 程序正常启动
- [ ] 服务启动成功（UDP + TCP端口）
- [ ] 用户列表显示
- [ ] 双击打开聊天窗口

### 聊天窗口
- [ ] 窗口正常显示
- [ ] 界面布局正确
- [ ] 输入框可用
- [ ] Send按钮可点击

### 消息发送
- [ ] 能输入文本
- [ ] 点击Send后消息显示
- [ ] 消息样式正确（蓝色气泡）
- [ ] 时间戳显示
- [ ] 输入框自动清空

### 高级功能
- [ ] 多窗口管理正常
- [ ] 窗口复用工作
- [ ] 窗口关闭正常
- [ ] 连续发送无问题
- [ ] 长消息正确显示

## 🐛 问题报告

如发现问题，请记录：
1. **问题描述**: 
2. **重现步骤**: 
3. **预期行为**: 
4. **实际行为**: 
5. **错误信息**（如有）: 

## ✅ 测试结论

- **测试日期**: 2025-11-20
- **测试人员**: 
- **总体状态**: 
- **通过项目**: __/20
- **发现问题**: 
- **是否可交付**: □ 是  □ 否  □ 待改进

---

**备注**: 这是Sprint 2的中期测试版本，部分功能尚未完全实现，但核心UI和消息发送流程已完整。
