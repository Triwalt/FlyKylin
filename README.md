# FlyKylin - æ™ºèƒ½é£ç§‹

> è·¨å¹³å°å±€åŸŸç½‘P2På³æ—¶é€šè®¯å·¥å…·ï¼Œé›†æˆAIåŠŸèƒ½ï¼ˆNSFWæ£€æµ‹ã€è¯­ä¹‰æœç´¢ï¼‰

## ğŸ¯ é¡¹ç›®ç®€ä»‹

FlyKylinæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å±€åŸŸç½‘å³æ—¶é€šè®¯å·¥å…·ï¼Œæ”¯æŒWindowså’ŒRK3566åµŒå…¥å¼å¹³å°ã€‚é¡¹ç›®é‡‡ç”¨Qt QMLæ„å»ºç”¨æˆ·ç•Œé¢ï¼Œé›†æˆäº†åŸºäºæ·±åº¦å­¦ä¹ çš„å†…å®¹å®‰å…¨æ£€æµ‹å’Œè¯­ä¹‰æœç´¢åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°åŠŸèƒ½

- âœ… **P2Pé€šä¿¡** - UDPå¹¿æ’­èŠ‚ç‚¹å‘ç° + TCPé•¿è¿æ¥æ¶ˆæ¯ä¼ è¾“
- âœ… **QMLç•Œé¢** - ç°ä»£åŒ–Qt Quickç”¨æˆ·ç•Œé¢
- âœ… **Protobufåè®®** - ç»“æ„åŒ–æ¶ˆæ¯åºåˆ—åŒ–
- âœ… **NSFWæ£€æµ‹** - AIå†…å®¹å®‰å…¨æ£€æµ‹ï¼ˆONNX Runtime / RKNNåŒåç«¯ï¼‰
- âœ… **è¯­ä¹‰æœç´¢** - åŸºäºBGEæ¨¡å‹çš„èŠå¤©è®°å½•è¯­ä¹‰æœç´¢
- âœ… **æ¶ˆæ¯å­˜å‚¨** - SQLiteæœ¬åœ°æ•°æ®åº“
- âœ… **è·¨å¹³å°** - Windows (Qt6) + RK3566 (Qt5.12)
- âœ… **åç¨‹æ”¯æŒ** - QCoroå¼‚æ­¥ç¼–ç¨‹

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|
| PeerDiscovery | UDPå¹¿æ’­èŠ‚ç‚¹å‘ç° | âœ… å®Œæˆ |
| TcpConnectionManager | TCPè¿æ¥ç®¡ç† | âœ… å®Œæˆ |
| MessageService | æ¶ˆæ¯æ”¶å‘æœåŠ¡ | âœ… å®Œæˆ |
| NSFWDetector | NSFWå†…å®¹æ£€æµ‹ | âœ… å®Œæˆ |
| TextEmbeddingEngine | æ–‡æœ¬å‘é‡åŒ– | âœ… å®Œæˆ |
| ChatSearchService | è¯­ä¹‰æœç´¢æœåŠ¡ | âœ… å®Œæˆ |
| DatabaseService | æ•°æ®æŒä¹…åŒ– | âœ… å®Œæˆ |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| è¯­è¨€ | C++ | C++17 |
| UIæ¡†æ¶ | Qt QML | Qt6 (Windows) / Qt5.12 (RK3566) |
| ç½‘ç»œ | Qt Network | - |
| åºåˆ—åŒ– | Protocol Buffers | 5.x |
| AIæ¨ç† | ONNX Runtime | 1.23.2 |
| NPUæ¨ç† | RKNN | 2.3.2 (RK3566) |
| æ•°æ®åº“ | SQLite | - |
| åç¨‹ | QCoro | 0.10.0 |
| æ„å»º | CMake + vcpkg | CMake 3.20+ |
| æµ‹è¯• | Google Test | - |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Windows**: Visual Studio 2022, Qt 6.5+, CMake 3.20+
- **RK3566**: GCC 11+, Qt 5.12.8, RKNN Toolkit 2.3.2

### Windowsæ„å»º

```powershell
# å…‹éš†é¡¹ç›®
git clone https://github.com/user/FlyKylin.git
cd FlyKylin

# ä½¿ç”¨CMake Presetæ„å»º
cmake --preset windows-release
cmake --build build/windows-release --config Release

# è¿è¡Œ
.\build\windows-release\bin\FlyKylin.exe
```

### RK3566äº¤å‰ç¼–è¯‘

è¯¦è§ [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT_GUIDE.md)

```bash
# WSLä¸­äº¤å‰ç¼–è¯‘
./scripts/build-rk3566-cross.sh --all

# éƒ¨ç½²åˆ°æ¿ç«¯
./scripts/deploy-to-board.sh --all
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
FlyKylin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ communication/    # P2Pé€šä¿¡ (UDPå‘ç°, TCPè¿æ¥)
â”‚   â”‚   â”œâ”€â”€ ai/              # AIå¼•æ“ (NSFWæ£€æµ‹, æ–‡æœ¬åµŒå…¥)
â”‚   â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡ (æ¶ˆæ¯, æ–‡ä»¶ä¼ è¾“, ç¾¤èŠ)
â”‚   â”‚   â”œâ”€â”€ database/        # æ•°æ®æŒä¹…åŒ–
â”‚   â”‚   â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ adapters/        # é€‚é…å™¨ (Protobufåºåˆ—åŒ–)
â”‚   â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹ (Message, PeerNode)
â”‚   â”‚   â””â”€â”€ ports/           # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ qml/             # QMLç•Œé¢æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ viewmodels/      # MVVMè§†å›¾æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ widgets/         # Qt Widgets (å¤‡ç”¨)
â”‚   â”‚   â””â”€â”€ windows/         # çª—å£ç±»
â”‚   â””â”€â”€ platform/            # å¹³å°ç‰¹å®šä»£ç 
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ onnx/                # ONNXæ¨¡å‹ (open_nsfw, bge-small-zh)
â”‚   â””â”€â”€ rknn/                # RKNNæ¨¡å‹ (RK3566ä¸“ç”¨)
â”œâ”€â”€ protocol/                # Protobufæ¶ˆæ¯å®šä¹‰
â”œâ”€â”€ tests/                   # å•å…ƒæµ‹è¯•
â”œâ”€â”€ scripts/                 # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ 3rdparty/               # ç¬¬ä¸‰æ–¹åº“ (ONNX Runtime, RKNN)
â””â”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
```

## ğŸ“Š å¼€å‘è¿›åº¦

### SprintçŠ¶æ€

| Sprint | å†…å®¹ | çŠ¶æ€ |
|--------|------|------|
| Sprint 1 | P2Pé€šä¿¡åŸºç¡€ | âœ… å®Œæˆ |
| Sprint 2 | ç”¨æˆ·ä½“ç³»ä¸åˆ†ç»„ | âœ… å®Œæˆ |
| Sprint 3 | ç¾¤èŠä¸æ–‡ä»¶ä¼ è¾“ | âœ… å®Œæˆ |
| Sprint 4 | è·¨å¹³å°æ”¯æŒ | âœ… å®Œæˆ |
| Sprint 5 | NSFWæ£€æµ‹ (NPUåŠ é€Ÿ) | âœ… å®Œæˆ |
| Sprint 6 | è¯­ä¹‰æœç´¢ | âœ… å®Œæˆ |

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   QML UI Layer                          â”‚
â”‚              (Main.qml, ChatView.qml, ...)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 ViewModel Layer                         â”‚
â”‚    (PeerListViewModel, ChatViewModel, SettingsVM)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Service Layer                          â”‚
â”‚  (MessageService, ChatSearchService, FileTransfer)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Core Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Communicationâ”‚     AI       â”‚   Database   â”‚        â”‚
â”‚  â”‚ (UDP/TCP)    â”‚ (NSFW/BGE)   â”‚  (SQLite)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Hardware Abstraction                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚   NPU    â”‚   GPU    â”‚  CPU Fallbackâ”‚               â”‚
â”‚   â”‚ (RK3566) â”‚ (Windows)â”‚              â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](docs/GETTING_STARTED.md) - ç¯å¢ƒé…ç½®å’Œé¦–æ¬¡æ„å»º
- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT_GUIDE.md) - Windowså’ŒRK3566éƒ¨ç½²è¯´æ˜
- [éœ€æ±‚æ–‡æ¡£](docs/requirements/FlyKylinéœ€æ±‚.md) - é¡¹ç›®éœ€æ±‚å’ŒSprintè§„åˆ’
- [RKNNè°ƒè¯•æ€»ç»“](docs/RKNN_DEBUG_SUMMARY.md) - RK3566 NPUè°ƒè¯•è®°å½•
- [æ¶æ„ææ¡ˆ](ARCHITECTURE_PROPOSAL.md) - æœªæ¥æ¶æ„æ¼”è¿›è§„åˆ’ï¼ˆå‚è€ƒï¼‰

## ğŸ”§ å¼€å‘å·¥å…·

### è„šæœ¬è¯´æ˜

| è„šæœ¬ | ç”¨é€” |
|------|------|
| `scripts/build-windows.ps1` | Windowsæ„å»ºè„šæœ¬ |
| `scripts/build-rk3566-cross.sh` | RK3566äº¤å‰ç¼–è¯‘ |
| `scripts/deploy-to-board.sh` | éƒ¨ç½²åˆ°RK3566æ¿ç«¯ |
| `scripts/check-environment.ps1` | Windowsç¯å¢ƒæ£€æŸ¥ |
| `scripts/check-environment.sh` | Linuxç¯å¢ƒæ£€æŸ¥ |

è¯¦è§ [scripts/README.md](scripts/README.md)

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestã€‚

---

**FlyKylin** - ç®€æ´ã€å¿«é€Ÿã€æ™ºèƒ½çš„å±€åŸŸç½‘é€šè®¯å·¥å…· ğŸš€
